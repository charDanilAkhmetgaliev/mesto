(()=>{"use strict";var e=".popup__form",t=".popup_new-card",n=".popup_edit-profile",r=".popup_avatar-update",o={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_inactive",inputErrorClass:"popup__input_error",activeErrorClass:"popup__error_active",errorClass:".popup__error"},i=document.querySelector(".profile__edit-avatar-button"),a=document.querySelector(".profile__add-button"),u=document.querySelector(".profile__edit-button"),c=document.querySelector(n).querySelector(e),s=document.querySelector(t).querySelector(e),l=document.querySelector(r).querySelector(e);function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var f=function(){function e(t){var n=t.cardData,r=t.templateSelector,o=t.handleCardClick,i=t.cardDelPopup,a=t.doLike,u=t.delLike;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._cardData=n,this._handleCardClick=o,this._dataTemplateElement=document.querySelector("".concat(r)).content,this._cardUserId=n.owner._id,this._cardDelPopup=i,this._handleDoLike=a,this._handleDelLike=u,this._isLiked=!1}var t,n;return t=e,(n=[{key:"_addToggleLikeListener",value:function(){var e=this;this._cardLikeButton.addEventListener("click",(function(){e._processDoLike().catch((function(e){return console.log(e)}))}))}},{key:"_checkLiked",value:function(){var e=this;this._cardLikes.forEach((function(t){if(Object.is(t._id,e._userId)&&e._cardLikes.length>0)return e._isLiked=!0}))}},{key:"_toggleLike",value:function(){this._cardLikeButton.classList.toggle("card__like_active")}},{key:"_processDoLike",value:function(){return this._isLiked?(this._toggleLike(),this._handleDelLike(this._cardData._id)):(this._toggleLike(),this._handleDoLike(this._cardData._id))}},{key:"_processRenderLike",value:function(){this._cardLikesCount=this._card.querySelector(".card__likes-count"),this._cardLikesCount.textContent=this._cardLikes.length,this._isLiked&&this._toggleLike()}},{key:"_processDelCardButton",value:function(){var e=this;Object.is(this._cardUserId,this._userId)&&(this._cardDeleteButton.classList.add("card__delete-button_active"),this._cardDeleteButton.addEventListener("click",(function(){return e._cardDelPopup.open(e._cardData._id)})))}},{key:"_buildCardContent",value:function(){var e=this;this._cardElement=this._dataTemplateElement.querySelector(".card"),this._card=this._cardElement.cloneNode(!0),this.cardImage=this._card.querySelector(".card__image"),this._cardTitle=this._card.querySelector(".card__title"),this._cardDeleteButton=this._card.querySelector(".card__delete-button"),this._cardLikes=this._cardData.likes,this._cardLikeButton=this._card.querySelector(".card__like"),this._checkLiked(),this._processDelCardButton(),this._cardTitle.textContent=this._cardData.name,this.cardImage.src=this._cardData.link,this.cardImage.alt="Изображение ".concat(this._cardData.name),this._processRenderLike(),this.cardImage.addEventListener("click",(function(){return e._handleCardClick(e._cardData)}))}},{key:"createCard",value:function(e){return this._userId=e,this._buildCardContent(),this._addToggleLikeListener(),this._card}}])&&p(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._validationSetting=t,this._formElement=n,this._inputList=Array.from(this._formElement.querySelectorAll(this._validationSetting.inputSelector)),this._buttonElement=this._formElement.querySelector(this._validationSetting.submitButtonSelector),this._formErrorList=Array.from(this._formElement.querySelectorAll(this._validationSetting.errorClass))}var t,n;return t=e,(n=[{key:"_showInputError",value:function(e){this._errorElement=this._formElement.querySelector(".".concat(e.id,"-error")),e.classList.add(this._validationSetting.inputErrorClass),this._errorElement.textContent=e.validationMessage,this._errorElement.classList.add(this._validationSetting.activeErrorClass)}},{key:"_hideInputError",value:function(e){this._errorElement=this._formElement.querySelector(".".concat(e.id,"-error")),e.classList.remove(this._validationSetting.inputErrorClass),this._errorElement.classList.remove(this._validationSetting.activeErrorClass),this._errorElement.textContent=""}},{key:"_hasInvalidInput",value:function(){return this._inputList.some((function(e){return!e.validity.valid}))}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}},{key:"_toggleButtonState",value:function(){this._hasInvalidInput()?this._disableSubmitButton():this._enableSubmitButton()}},{key:"_disableSubmitButton",value:function(){this._buttonElement.classList.add(this._validationSetting.inactiveButtonClass),this._buttonElement.disabled=!0}},{key:"_enableSubmitButton",value:function(){this._buttonElement.classList.remove(this._validationSetting.inactiveButtonClass),this._buttonElement.disabled=!1}},{key:"enableValidation",value:function(){var e=this;this._toggleButtonState(),this._inputList.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e._toggleButtonState()}))}))}},{key:"resetValidation",value:function(){var e=this;this._disableSubmitButton(),this._inputList.forEach((function(t){e._hideInputError(t)}))}}])&&d(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var y=function(){function e(t){var n,r,o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=function(e){"Escape"!==e.key&&"Esc"!==e.key||o.close()},(n="_handleEscClose")in this?Object.defineProperty(this,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[n]=r,this._popup=document.querySelector(t),this._buttonClose=this._popup.querySelector(".popup__close-button"),this._popupSubmitButton=this._popup.querySelector(".popup__save-button")}var t,n;return t=e,(n=[{key:"setEventListeners",value:function(){var e=this;this._buttonClose.addEventListener("click",this.close.bind(this)),this._popup.addEventListener("click",(function(t){t.target.classList.contains("popup")&&e.close()}))}},{key:"open",value:function(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"renderLoading",value:function(e){e?(this._textDefSubmitButton=this._popupSubmitButton.textContent,this._popupSubmitButton.textContent="Сохранение..."):this._popupSubmitButton.textContent=this._textDefSubmitButton}}])&&_(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},m(e,t)}function k(e,t){if(t&&("object"===b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return g(e)}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function E(){return E="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=S(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},E.apply(this,arguments)}function S(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=w(e)););return e}function w(e){return w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},w(e)}var L=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&m(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=w(r);if(o){var n=w(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return k(this,e)});function a(e){var t,n,r,o,u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),u=function(e){n._setData(e.name,e.link),E((t=g(n),w(a.prototype)),"open",t).call(t)},(o="open")in(r=g(n=i.call(this,e)))?Object.defineProperty(r,o,{value:u,enumerable:!0,configurable:!0,writable:!0}):r.open=u,n._popupImage=n._popup.querySelector(".popup__image"),n._popupLabel=n._popup.querySelector(".popup__label"),n}return t=a,(n=[{key:"_setData",value:function(e,t){this._popupImage.src=t,this._popupImage.alt="Изображение ".concat(e),this._popupLabel.textContent=e}}])&&v(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(y);function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(e,t){return C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},C(e,t)}function P(e,t){if(t&&("object"===O(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return D(e)}function D(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(){return I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=q(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},I.apply(this,arguments)}function q(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=R(e)););return e}function R(e){return R=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},R(e)}function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var T=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&C(e,t)}(u,t);var n,r,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=R(o);if(i){var n=R(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return P(this,e)});function u(t,n){var r,o,i,c,s=t.submitForm;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),B(D(c=a.call(this,n)),"_getInputValues",(function(){return c._inputData={},c._inputList.forEach((function(e){c._inputData[e.name]=e.value})),c._inputData})),B(D(c),"setEventListeners",(function(){I((r=D(c),R(u.prototype)),"setEventListeners",r).call(r),c._popup.addEventListener("submit",(function(e){e.preventDefault(),I((o=D(c),R(u.prototype)),"renderLoading",o).call(o,!0),c._handleSubmit(c._getInputValues()).catch((function(e){return console.log(e)})).finally((function(){return I((i=D(c),R(u.prototype)),"renderLoading",i).call(i,!1)}))}))})),c._handleSubmit=s,c._inputList=c._popup.querySelectorAll(".popup__input"),c._popupForm=c._popup.querySelector(e),c}return n=u,(r=[{key:"setInputValues",value:function(e){this._inputList.forEach((function(t){t.value=e[t.name]}))}},{key:"close",value:function(){this._popupForm.reset(),I(R(u.prototype),"close",this).call(this)}}])&&j(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),u}(y);function x(e){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(e)}function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function U(e,t){return U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},U(e,t)}function A(e,t){if(t&&("object"===x(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return F(e)}function F(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function N(){return N="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=H(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},N.apply(this,arguments)}function H(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=z(e)););return e}function z(e){return z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},z(e)}var G=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&U(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=z(r);if(o){var n=z(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return A(this,e)});function a(e,t){var n,r,o,u,c,s,l,p=e.submitForm;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),l=function(){N((n=F(u),z(a.prototype)),"setEventListeners",n).call(n),u._popup.addEventListener("submit",(function(e){e.preventDefault(),N((r=F(u),z(a.prototype)),"renderLoading",r).call(r,!0),u._handleSubmit(u._cardId).catch((function(e){return console.log(e)})).finally((function(){return N((o=F(u),z(a.prototype)),"renderLoading",o).call(o,!1)}))}))},(s="setEventListeners")in(c=F(u=i.call(this,t)))?Object.defineProperty(c,s,{value:l,enumerable:!0,configurable:!0,writable:!0}):c[s]=l,u._handleSubmit=p,u}return t=a,(n=[{key:"open",value:function(e){this._cardId=e,N(z(a.prototype),"open",this).call(this)}}])&&V(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(y);function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var J=function(){function e(t,n){var r=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderItem=r,this._container=document.querySelector(n)}var t,n;return t=e,(n=[{key:"addItem",value:function(e){this._container.prepend(e)}},{key:"clearCards",value:function(){this._container.innerHTML=""}}])&&M(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Q,W=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._userNameElement=document.querySelector(".profile__name"),this._userInfoElement=document.querySelector(".profile__status"),this._userAvatar=document.querySelector(".profile__avatar")}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return this._userData={},this._userData.name=this._userNameElement.textContent,this._userData.about=this._userInfoElement.textContent,this._userData}},{key:"setUserInfo",value:function(e){var t=e.name,n=e.about,r=e.avatar;this._userNameElement.textContent=t,this._userInfoElement.textContent=n,this._userAvatar.src=r}}])&&K(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function X(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(Q=new(function(){function e(t,n){var r=n.userToken,o=n.cohortName;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._url=t,this._userToken=r,this._cohort=o}var t,n;return t=e,(n=[{key:"_processResponse",value:function(e,t){return e.ok?e.json():Promise.reject(t)}},{key:"createSimpleRequest",value:function(e,t,n){var r=this;return this._completeUrl="".concat(this._url,"/").concat(this._cohort).concat(e),fetch(this._completeUrl,{method:t,headers:{authorization:"".concat(this._userToken)}}).then((function(e){return r._processResponse(e,n)}))}},{key:"createBodyRequest",value:function(e,t,n,r){var o=this;return this._completeUrl="".concat(this._url,"/").concat(this._cohort).concat(e),fetch(this._completeUrl,{method:t,headers:{authorization:"".concat(this._userToken),"content-type":"application/json"},body:JSON.stringify(r)}).then((function(e){return o._processResponse(e,n)}))}}])&&X(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}())("https://mesto.nomoreparties.co/v1",{userToken:"320b4a75-5470-48e7-b4e8-36be65b57c43",cohortName:"cohort-58"})).createSimpleRequest("/users/me","GET","Ошибка авторизации").then((function(e){function p(){Q.createSimpleRequest("/cards","GET","Ошибка обновления карточек").then((function(e){e.reverse(),S.clearCards(),e.forEach((function(e){S.renderItem(e)}))}))}var d=new h(o,l);d.enableValidation();var _=new h(o,c);_.enableValidation();var y=new h(o,s);y.enableValidation();var b=new L(".popup_card");b.setEventListeners();var v=new W,m=new G({submitForm:function(e){return Q.createSimpleRequest("/cards/".concat(e),"DELETE","Ошибка удаления карточки").then((function(e){p(),m.close()}))}},".popup_card-delete");m.setEventListeners();var k=new T({submitForm:function(e){return Q.createBodyRequest("/users/me/avatar","PATCH","Ошибка обновления аватара",e).then((function(e){v.setUserInfo(e),k.close()}))}},r);k.setEventListeners();var g=new T({submitForm:function(e){return Q.createBodyRequest("/cards","POST","Ошибка добавления карточки",e).then((function(e){S.renderItem(e),g.close()}))}},t);g.setEventListeners();var E=new T({submitForm:function(e){return Q.createBodyRequest("/users/me","PATCH","Ошибка обновления профиля",e).then((function(e){v.setUserInfo(e),E.close()}))}},n);E.setEventListeners();var S=new J({renderer:function(t){var n=new f({cardData:t,templateSelector:".template",handleCardClick:b.open,cardDelPopup:m,doLike:function(e){return Q.createSimpleRequest("/cards/".concat(e,"/likes"),"PUT","Ошибка лайка").then((function(e){p()}))},delLike:function(e){return Q.createSimpleRequest("/cards/".concat(e,"/likes"),"DELETE","Ошибка удаления лайка").then((function(e){p()}))}}).createCard(e._id);S.addItem(n)}},".elements__list");i.addEventListener("click",(function(){d.resetValidation(),k.open()})),a.addEventListener("click",(function(){y.resetValidation(),g.open()})),u.addEventListener("click",(function(){_.resetValidation(),function(){var e=v.getUserInfo();E.setInputValues(e)}(),E.open()})),v.setUserInfo(e),p(),setInterval(p,4e3)}))})();